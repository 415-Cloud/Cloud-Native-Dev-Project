@startuml
left to right direction

skinparam backgroundColor #ffffff
skinparam componentStyle rectangle
skinparam shadowing false
skinparam packageStyle rectangle
skinparam ArrowColor #555555
skinparam RectangleBorderColor #333333
skinparam RectangleFontColor #000000
skinparam RectangleFontSize 12
skinparam defaultTextAlignment center
skinparam linetype ortho

actor "Frontend (React)" as React

component "API Gateway" as APIGW

package "Microservices" {
    component "Auth Service\n(Spring Boot / JWT)" as Auth
    component "User Service\n(Spring Boot)" as User
    component "Workout Service\n(Node.js)" as Workout
    component "Challenge Service\n(Node.js)" as Challenge
    component "Leaderboard Service\n(Spring Boot)" as Leaderboard
    component "Coach Service\n(AI)" as Coach
}

queue "RabbitMQ\n(Message Broker)" as MQ
database "PostgreSQL\n(per service DB)" as PG
collections "Redis\n(Cache / Leaderboard)" as Redis

React --> APIGW : HTTPS/REST
APIGW --> Auth : Login/Register\n(JWT)
APIGW --> User
APIGW --> Workout
APIGW --> Challenge
APIGW --> Leaderboard
APIGW --> Coach

Auth --> PG
User --> PG
Workout --> PG
Challenge --> PG
Leaderboard --> PG
Coach --> PG

Auth --> MQ
User --> MQ
Workout --> MQ
Challenge --> MQ
Leaderboard --> MQ
Coach --> MQ

Auth --> Redis : JWT Sessions
Leaderboard --> Redis

note bottom of PG
Each microservice has its own dedicated database
end note

note bottom of MQ
Services communicate asynchronously using RabbitMQ message broker
end note

note right of Redis
Redis caches leaderboard data and stores JWT sessions
end note

@enduml
